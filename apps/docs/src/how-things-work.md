---
outline: deep
---

# How Things Work

Unlike most traditional note types, Kiku is entirely written in TypeScript using the JavaScript UI library [SolidJS](https://www.solidjs.com/),
which makes highly interactive UI possible.

It also uses SolidJSâ€™s SSR/hydration features, making the initial page load instant. Components such as the header, definition view, and others are lazy-loaded.

## Kiku files

Kiku stores certain files in your Anki `collection.media` directory. All of these filenames are prefixed with `_kiku`.

```json
[
  "_kiku_style.css",
  "_kiku.css",
  "_kiku_plugin.css",
  "_kiku_notes_0.json.gz",
  "_kiku_notes_1.json.gz",
  "_kiku_notes_2.json.gz",
  "_kiku_notes_3.json.gz",
  "_kiku_notes_4.json.gz",
  "_kiku_notes_5.json.gz",
  "_kiku_notes_6.json.gz",
  "_kiku_notes_7.json.gz",
  "_kiku_notes_8.json.gz",
  "_kiku_notes_9.json.gz",
  "_kiku_back.html",
  "_kiku_front.html",
  "_kiku_lazy.js",
  "_kiku_libs.js",
  "_kiku_plugin.js",
  "_kiku_shared.js",
  "_kiku_worker.js",
  "_kiku.js",
  "_kiku_config.json",
  "_kiku_db_main_manifest.json",
  "_kiku_notes_manifest.json",
  "_kiku_db_main.tar",
  "_kiku_font_hina-mincho.woff2",
  "_kiku_font_ibm-plex-sans-jp.woff2",
  "_kiku_font_klee-one.woff2"
]
```

Some explanations about these files:

- Your configuration is stored in the `_kiku_config.json` file.
- `_kiku_notes_1.json.gz`, `_kiku_notes_2.json.gz`, `_kiku_notes_*`, etc. are generated by the Kiku Note Manager for the Kanji View feature. They store the same output as the [`notesInfo`](https://git.sr.ht/~foosoft/anki-connect#codenotesinfocode) API from AnkiConnect for all notes with the `modelName` **"Kiku"** or **"Lapis"**.
- `_kiku_db_main.tar` and `_kiku_db_main_manifest.json` are the databases Kiku uses for the kanji lookup feature.
- Some JavaScript modules (`_kiku*.js`), such as `_kiku_lazy.js`, are lazy-loaded after the initial page render.
  `_kiku_worker.js` is used for ~~multithreading~~ JavaScript operations via [Web Workers](https://developer.mozilla.org/en-US/docs/Web/API/Worker).
- `_kiku.css` contains all styles for Kiku.
- `_kiku_front.html`, `_kiku_back.html`, and `_kiku_style.css` are the templates used to update the Front Template, Back Template, and Styling of the note when saving in the settings.
- `_kiku_font_*.woff2` are the custom fonts included by default.

## Settings

Every settings change is applied immediately, and the changes are saved to [`sessionStorage`](https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage).
The settings stored in `sessionStorage` are cleared when you exit the review screen.

To make the settings persistent, AnkiConnect is required.
When AnkiConnect is running, you can click the **"Save"** button on the Settings page. This will:

- Save the settings to `_kiku_config.json`.
- Update some settings stored in the Front Template, Back Template, and Styling of the **"Kiku"** note using `_kiku_front.html`, `_kiku_back.html`, and `_kiku_style.css`.

### Default Config

<<< ../../../packages/note/src/util/defaulConfig.ts

### Settings Stored in the Front/Back/Styling Templates

::: details Why are some settings stored in the Front/Back/Styling templates? {open}
CSS loads instantly, but JavaScript runs only after the initial render.
If we relied only on the JSON settings, the card would briefly show the wrong theme or font before JavaScript applies the correct ones (a [FOUC](https://en.wikipedia.org/wiki/Flash_of_unstyled_content)).
Storing key settings in the templates avoids this flicker.
:::

```js
[
  "theme",
  "blurNsfw",
  "pictureOnFront",
  "modVertical",
  "fontSizeBaseExpression",
  "fontSizeBasePitch",
  "fontSizeBaseSentence",
  "fontSizeBaseMiscInfo",
  "fontSizeBaseHint",
  "fontSizeSmExpression",
  "fontSizeSmPitch",
  "fontSizeSmSentence",
  "fontSizeSmMiscInfo",
  "fontSizeSmHint",
];
```
